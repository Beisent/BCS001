## 深度缓冲 (Z-Buffer)

**深度缓冲（Z-Buffer）** 是一种用于解决场景可见性问题的技术。它通过记录每个像素的深度值（ 轴分量），确保在绘制时只有最靠近观察者的像素会被最终呈现在屏幕上。

### 核心原理

与颜色缓冲区类似，深度缓冲区是一个与屏幕分辨率一致的二维数组。在渲染每一帧时：

* **比较：** 系统会检查当前像素的深度值是否大于/小于深度缓冲区中已记录的值。
* **更新：** 如果当前像素大于/小于缓冲区中已记录的值，则通过测试，更新该点的颜色缓冲区，并同步刷新深度缓冲区中的值。

### 实现流程

深度缓冲的标准流水线如下：

1. **初始化：** 在渲染开始前，创建深度缓冲区，并将所有像素的深度初始值设置为最小/大值。
2. **深度测试：** 在处理每个像素时，获取其当前坐标z轴分量。
3. **逻辑判定：** 判断当前深度值是否大于/小于缓冲区中的值：
* **通过：** 若当前值更大，执行绘制逻辑，并将此新深度值写入缓冲区。
* **剔除：** 若当前值更小，说明该片段被遮挡，直接丢弃，不执行绘制。

![](./s002/z-buffer.png)